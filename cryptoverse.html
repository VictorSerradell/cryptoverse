<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoVerse ‚Äî Premium Crypto Dashboard 2026</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@300;400;500;600&display=swap"
        rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        :root {
            --bg: #020207;
            --bg2: #07071a;
            --surface: rgba(255, 255, 255, 0.03);
            --surface2: rgba(255, 255, 255, 0.06);
            --border: rgba(255, 255, 255, 0.08);
            --border-glow: rgba(99, 102, 241, 0.4);
            --neon-indigo: #6366f1;
            --neon-violet: #8b5cf6;
            --neon-pink: #ec4899;
            --neon-cyan: #22d3ee;
            --neon-green: #10b981;
            --neon-red: #ef4444;
            --text: #f1f5f9;
            --text-muted: #64748b;
            --text-dim: #334155;
            --gold: #f59e0b;
            --font: 'Space Grotesk', sans-serif;
            --mono: 'JetBrains Mono', monospace;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font);
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            cursor: default;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 4px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--neon-indigo);
            border-radius: 2px;
        }

        /* =========== CANVAS =========== */
        #bg-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            pointer-events: none;
        }

        /* =========== LAYOUT =========== */
        .app {
            position: relative;
            z-index: 1;
            display: grid;
            grid-template-rows: auto 1fr;
            min-height: 100vh;
        }

        /* =========== HEADER =========== */
        .header {
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px) saturate(180%);
            background: rgba(2, 2, 7, 0.8);
            border-bottom: 1px solid var(--border);
            padding: 0 2rem;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1.5rem;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            text-decoration: none;
            flex-shrink: 0;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--neon-indigo), var(--neon-pink));
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
            animation: logoGlow 3s ease-in-out infinite;
        }

        @keyframes logoGlow {

            0%,
            100% {
                box-shadow: 0 0 20px rgba(99, 102, 241, 0.5);
            }

            50% {
                box-shadow: 0 0 40px rgba(139, 92, 246, 0.8), 0 0 60px rgba(236, 72, 153, 0.3);
            }
        }

        .logo-text {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, #fff 40%, var(--neon-violet));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .search-bar {
            flex: 1;
            max-width: 340px;
            position: relative;
        }

        .search-input {
            width: 100%;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            color: var(--text);
            font-family: var(--font);
            font-size: 0.85rem;
            outline: none;
            transition: all 0.3s;
        }

        .search-input:focus {
            border-color: var(--neon-indigo);
            background: var(--surface2);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        .search-input::placeholder {
            color: var(--text-muted);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-size: 14px;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-shrink: 0;
        }

        .live-badge {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.72rem;
            font-family: var(--mono);
            color: var(--text-muted);
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 0.35rem 0.75rem;
            border-radius: 6px;
        }

        .live-dot {
            width: 6px;
            height: 6px;
            background: var(--neon-green);
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(0.8);
            }
        }

        .btn {
            padding: 0.5rem 1.1rem;
            border-radius: 8px;
            font-family: var(--font);
            font-size: 0.82rem;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.25s;
            letter-spacing: 0.01em;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--neon-indigo), var(--neon-violet));
            color: white;
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.6);
        }

        .btn-ghost {
            background: var(--surface);
            color: var(--text-muted);
            border: 1px solid var(--border);
        }

        .btn-ghost:hover {
            background: var(--surface2);
            color: var(--text);
            border-color: var(--neon-indigo);
        }

        /* =========== MAIN =========== */
        .main {
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
        }

        /* =========== HERO =========== */
        .hero {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
            align-items: center;
            min-height: 320px;
        }

        .hero-left {}

        .hero-label {
            font-size: 0.72rem;
            font-family: var(--mono);
            color: var(--neon-indigo);
            letter-spacing: 0.15em;
            text-transform: uppercase;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .hero-label::before {
            content: '';
            width: 20px;
            height: 1px;
            background: var(--neon-indigo);
        }

        .portfolio-value {
            font-size: clamp(3rem, 6vw, 5rem);
            font-weight: 700;
            letter-spacing: -0.04em;
            line-height: 1;
            background: linear-gradient(135deg, #fff 30%, var(--neon-violet) 70%, var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
            font-variant-numeric: tabular-nums;
        }

        .hero-stats {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .hero-stat {
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .hero-stat-label {
            font-size: 0.7rem;
            font-family: var(--mono);
            color: var(--text-muted);
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .hero-stat-value {
            font-size: 1.1rem;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
        }

        .up {
            color: var(--neon-green);
        }

        .down {
            color: var(--neon-red);
        }

        .neutral {
            color: var(--text-muted);
        }

        /* 3D Orb Container */
        .orb-container {
            position: relative;
            height: 320px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #orb-canvas {
            border-radius: 50%;
            filter: drop-shadow(0 0 40px rgba(99, 102, 241, 0.3));
        }

        /* =========== GLASS CARD =========== */
        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 16px;
            backdrop-filter: blur(10px);
            transition: border-color 0.3s, transform 0.3s;
            overflow: hidden;
            position: relative;
        }

        .card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.05) 0%, transparent 50%);
            pointer-events: none;
        }

        .card:hover {
            border-color: var(--border-glow);
        }

        .card-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.08em;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-body {
            padding: 1.5rem;
        }

        /* =========== QUICK STATS ROW =========== */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        .stat-card {
            padding: 1.25rem;
            border-radius: 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
            cursor: default;
        }

        .stat-card::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--neon-indigo), var(--neon-pink));
            transform: scaleX(0);
            transform-origin: left;
            transition: transform 0.4s ease;
        }

        .stat-card:hover::after {
            transform: scaleX(1);
        }

        .stat-card:hover {
            border-color: var(--border-glow);
            transform: translateY(-2px);
        }

        .stat-label {
            font-size: 0.68rem;
            font-family: var(--mono);
            color: var(--text-muted);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 0.6rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }

        .stat-value {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            font-variant-numeric: tabular-nums;
            margin-bottom: 0.3rem;
        }

        .stat-sub {
            font-size: 0.72rem;
            color: var(--text-muted);
            font-family: var(--mono);
        }

        /* =========== TOP MOVERS =========== */
        .movers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1rem;
        }

        .mover-card {
            padding: 1.1rem;
            border-radius: 12px;
            background: var(--surface);
            border: 1px solid var(--border);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transform-style: preserve-3d;
        }

        .mover-card:hover {
            border-color: var(--border-glow);
            transform: translateY(-4px) rotateX(2deg);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4), 0 0 30px rgba(99, 102, 241, 0.15);
        }

        .mover-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .coin-info {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .coin-icon {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            overflow: hidden;
            background: var(--surface2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            border: 1px solid var(--border);
            flex-shrink: 0;
        }

        .coin-icon img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .coin-name {
            font-weight: 600;
            font-size: 0.9rem;
            line-height: 1.2;
        }

        .coin-ticker {
            font-size: 0.68rem;
            font-family: var(--mono);
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .coin-change {
            font-size: 0.8rem;
            font-weight: 700;
            font-family: var(--mono);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
        }

        .coin-change.up {
            background: rgba(16, 185, 129, 0.15);
            color: var(--neon-green);
        }

        .coin-change.down {
            background: rgba(239, 68, 68, 0.15);
            color: var(--neon-red);
        }

        .coin-price {
            font-size: 1.25rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.02em;
            margin-bottom: 0.3rem;
        }

        .coin-meta {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-family: var(--mono);
        }

        /* Mini sparkline */
        .sparkline {
            margin-top: 0.75rem;
            height: 40px;
        }

        /* =========== GRID 2 COL =========== */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        /* =========== PORTFOLIO TABLE =========== */
        .portfolio-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        .portfolio-table thead tr th {
            font-size: 0.67rem;
            font-family: var(--mono);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 0.75rem 1rem;
            text-align: left;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            font-weight: 500;
        }

        .portfolio-table thead tr th:last-child {
            text-align: right;
        }

        .portfolio-table tbody tr {
            transition: background 0.2s;
            cursor: pointer;
        }

        .portfolio-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.03);
        }

        .portfolio-table tbody tr td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
            font-size: 0.875rem;
            vertical-align: middle;
        }

        .portfolio-table tbody tr td:last-child {
            text-align: right;
        }

        .rank {
            font-family: var(--mono);
            font-size: 0.7rem;
            color: var(--text-dim);
            width: 2rem;
        }

        .alloc-bar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .alloc-track {
            flex: 1;
            height: 4px;
            background: var(--surface2);
            border-radius: 2px;
            overflow: hidden;
        }

        .alloc-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-indigo), var(--neon-pink));
            border-radius: 2px;
            transition: width 1s ease;
        }

        .alloc-pct {
            font-family: var(--mono);
            font-size: 0.72rem;
            color: var(--text-muted);
            min-width: 3rem;
            text-align: right;
        }

        /* =========== CHART AREA =========== */
        .chart-container {
            position: relative;
            height: 280px;
        }

        /* timeframe selector */
        .tf-selector {
            display: flex;
            gap: 0.25rem;
        }

        .tf-btn {
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.72rem;
            font-family: var(--mono);
            font-weight: 600;
            border: 1px solid transparent;
            cursor: pointer;
            background: transparent;
            color: var(--text-muted);
            transition: all 0.2s;
        }

        .tf-btn.active {
            background: linear-gradient(135deg, var(--neon-indigo), var(--neon-violet));
            color: white;
            border-color: transparent;
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.4);
        }

        .tf-btn:hover:not(.active) {
            background: var(--surface2);
            color: var(--text);
            border-color: var(--border);
        }

        /* =========== FEAR & GREED =========== */
        .gauge-wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            gap: 0.5rem;
        }

        .gauge-value {
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: -0.04em;
        }

        .gauge-label {
            font-size: 0.85rem;
            font-weight: 600;
        }

        .gauge-sub {
            font-size: 0.7rem;
            color: var(--text-muted);
            font-family: var(--mono);
        }

        .gauge-meter {
            width: 100%;
            max-width: 200px;
            height: 8px;
            background: linear-gradient(90deg, var(--neon-red), var(--gold), var(--neon-green));
            border-radius: 4px;
            position: relative;
            margin: 0.5rem 0;
        }

        .gauge-needle {
            position: absolute;
            top: -4px;
            width: 2px;
            height: 16px;
            background: white;
            border-radius: 1px;
            transform: translateX(-50%);
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.8);
            transition: left 1s ease;
        }

        /* =========== DOMINANCE =========== */
        .dominance-row {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.04);
        }

        .dom-name {
            font-size: 0.8rem;
            font-weight: 600;
            min-width: 3rem;
        }

        .dom-bar-track {
            flex: 1;
            height: 6px;
            background: var(--surface2);
            border-radius: 3px;
            overflow: hidden;
        }

        .dom-bar-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 1.5s ease;
        }

        .dom-pct {
            font-family: var(--mono);
            font-size: 0.75rem;
            font-weight: 600;
            min-width: 3.5rem;
            text-align: right;
        }

        /* =========== TOAST =========== */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background: rgba(7, 7, 26, 0.95);
            border: 1px solid var(--border-glow);
            border-radius: 12px;
            padding: 1rem 1.25rem;
            min-width: 280px;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            backdrop-filter: blur(20px);
            animation: slideIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 0 0 20px rgba(99, 102, 241, 0.2);
        }

        @keyframes slideIn {
            from {
                transform: translateX(120%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .toast-title {
            font-size: 0.85rem;
            font-weight: 700;
            margin-bottom: 0.2rem;
        }

        .toast-msg {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: var(--mono);
        }

        /* =========== FOOTER =========== */
        .footer {
            padding: 2rem;
            border-top: 1px solid var(--border);
            text-align: center;
            color: var(--text-muted);
            font-size: 0.75rem;
            font-family: var(--mono);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .footer a {
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer a:hover {
            color: var(--neon-indigo);
        }

        /* =========== LOADING SHIMMER =========== */
        .shimmer {
            background: linear-gradient(90deg,
                    rgba(255, 255, 255, 0.04) 25%,
                    rgba(255, 255, 255, 0.08) 50%,
                    rgba(255, 255, 255, 0.04) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 6px;
        }

        @keyframes shimmer {
            0% {
                background-position: 200% center;
            }

            100% {
                background-position: -200% center;
            }
        }

        .shimmer-text {
            height: 1em;
            width: 80%;
            display: inline-block;
        }

        /* =========== COUNTER ANIM =========== */
        @keyframes countUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .count-animated {
            animation: countUp 0.6s ease forwards;
        }

        /* =========== PRICE FLASH =========== */
        @keyframes flashGreen {

            0%,
            100% {
                background: transparent;
            }

            50% {
                background: rgba(16, 185, 129, 0.2);
            }
        }

        @keyframes flashRed {

            0%,
            100% {
                background: transparent;
            }

            50% {
                background: rgba(239, 68, 68, 0.2);
            }
        }

        .flash-green {
            animation: flashGreen 0.8s ease;
        }

        .flash-red {
            animation: flashRed 0.8s ease;
        }

        /* =========== HEATMAP =========== */
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            gap: 3px;
            padding: 1rem;
        }

        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.5rem;
            font-family: var(--mono);
            font-weight: 700;
            color: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            transition: transform 0.2s, opacity 0.2s;
            position: relative;
            overflow: hidden;
        }

        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .heatmap-cell .cell-tooltip {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1px;
            text-align: center;
            padding: 2px;
        }

        /* Responsive */
        @media (max-width: 1100px) {
            .hero {
                grid-template-columns: 1fr;
            }

            .orb-container {
                height: 220px;
            }

            .grid-3 {
                grid-template-columns: 1fr;
            }

            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .main {
                padding: 1rem;
            }

            .header {
                padding: 0 1rem;
            }

            .search-bar {
                display: none;
            }

            .grid-2 {
                grid-template-columns: 1fr;
            }

            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }

            .heatmap-grid {
                grid-template-columns: repeat(7, 1fr);
            }

            .portfolio-table thead tr th:nth-child(4),
            .portfolio-table tbody tr td:nth-child(4) {
                display: none;
            }

            .live-badge {
                display: none;
            }

            .btn-ghost {
                display: none;
            }
        }

        /* Glitch effect for prices */
        @keyframes glitch {
            0% {
                clip-path: inset(0 0 95% 0);
                transform: translateX(-2px);
            }

            20% {
                clip-path: inset(80% 0 5% 0);
                transform: translateX(2px);
            }

            40% {
                clip-path: inset(45% 0 40% 0);
                transform: translateX(-1px);
            }

            60% {
                clip-path: inset(0 0 0 0);
                transform: translateX(0);
            }

            100% {
                clip-path: inset(0 0 0 0);
                transform: translateX(0);
            }
        }

        .section-title {
            font-size: 0.7rem;
            font-family: var(--mono);
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .dot-divider {
            display: inline-flex;
            gap: 4px;
            align-items: center;
        }

        .dot-divider span {
            width: 3px;
            height: 3px;
            background: var(--neon-indigo);
            border-radius: 50%;
            opacity: 0.6;
        }
    </style>
</head>

<body>

    <!-- 3D Background Canvas -->
    <canvas id="bg-canvas"></canvas>

    <div class="app">
        <!-- ===== HEADER ===== -->
        <header class="header">
            <a class="logo" href="#">
                <div class="logo-icon">‚¨°</div>
                <span class="logo-text">CryptoVerse</span>
            </a>

            <div class="search-bar">
                <span class="search-icon">üîç</span>
                <input class="search-input" type="text" placeholder="Search tokens, coins, DeFi..." id="search-input">
            </div>

            <div class="header-actions">
                <div class="live-badge">
                    <div class="live-dot"></div>
                    <span id="last-update">LIVE</span>
                </div>
                <button class="btn btn-ghost" onclick="refreshData()">‚Üª Refresh</button>
                <button class="btn btn-primary" onclick="connectWallet()">‚¨° Connect Wallet</button>
            </div>
        </header>

        <!-- ===== MAIN ===== -->
        <main class="main">

            <!-- ===== HERO ===== -->
            <section class="hero">
                <div class="hero-left">
                    <div class="hero-label">Total Portfolio Value</div>
                    <div class="portfolio-value" id="portfolio-value">$284,391.00</div>
                    <div class="hero-stats">
                        <div class="hero-stat">
                            <span class="hero-stat-label">24h Change</span>
                            <span class="hero-stat-value up" id="hero-24h">+$12,840 (+4.73%)</span>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-label">7d Change</span>
                            <span class="hero-stat-value up" id="hero-7d">+$31,200 (+12.3%)</span>
                        </div>
                        <div class="hero-stat">
                            <span class="hero-stat-label">All-Time PnL</span>
                            <span class="hero-stat-value up">+$142,000 (+99.4%)</span>
                        </div>
                    </div>
                </div>

                <div class="orb-container">
                    <canvas id="orb-canvas" width="360" height="320"></canvas>
                </div>
            </section>

            <!-- ===== QUICK STATS ===== -->
            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-label">üåê Global Market Cap</div>
                    <div class="stat-value" id="global-mcap">$2.84T</div>
                    <div class="stat-sub" id="global-mcap-change">+3.2% today</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">‚Çø BTC Dominance</div>
                    <div class="stat-value" id="btc-dom" style="color: var(--gold)">52.4%</div>
                    <div class="stat-sub">of total market</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Œû ETH Dominance</div>
                    <div class="stat-value" id="eth-dom" style="color: var(--neon-violet)">17.1%</div>
                    <div class="stat-sub">of total market</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üò® Fear & Greed</div>
                    <div class="stat-value" id="fg-value" style="color: var(--gold)">72</div>
                    <div class="stat-sub" id="fg-label">Greed</div>
                </div>
            </div>

            <!-- ===== TOP MOVERS ===== -->
            <div>
                <div class="section-title">
                    <span>üî• Top Movers ‚Äî Real-time</span>
                    <div class="dot-divider"><span></span><span></span><span></span></div>
                </div>
                <div class="movers-grid" id="movers-grid">
                    <!-- populated by JS -->
                    <div class="mover-card shimmer" style="height:140px"></div>
                    <div class="mover-card shimmer" style="height:140px"></div>
                    <div class="mover-card shimmer" style="height:140px"></div>
                    <div class="mover-card shimmer" style="height:140px"></div>
                    <div class="mover-card shimmer" style="height:140px"></div>
                    <div class="mover-card shimmer" style="height:140px"></div>
                </div>
            </div>

            <!-- ===== CHARTS + PORTFOLIO ===== -->
            <div class="grid-3">

                <!-- Price Chart -->
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üìà Market Chart</span>
                        <div class="tf-selector">
                            <button class="tf-btn" data-tf="1">1H</button>
                            <button class="tf-btn active" data-tf="7">24H</button>
                            <button class="tf-btn" data-tf="30">7D</button>
                            <button class="tf-btn" data-tf="365">1Y</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div style="display:flex;gap:1rem;margin-bottom:1rem;flex-wrap:wrap;">
                            <button class="tf-btn active" data-coin="bitcoin" onclick="switchCoin(this,'bitcoin')">‚Çø
                                BTC</button>
                            <button class="tf-btn" data-coin="ethereum" onclick="switchCoin(this,'ethereum')">Œû
                                ETH</button>
                            <button class="tf-btn" data-coin="solana" onclick="switchCoin(this,'solana')">‚óé SOL</button>
                        </div>
                        <div class="chart-container">
                            <canvas id="price-chart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Right Panel -->
                <div style="display:flex;flex-direction:column;gap:1rem;">
                    <!-- Fear & Greed -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">üò® Fear & Greed Index</span>
                        </div>
                        <div class="gauge-wrap">
                            <div class="gauge-value up" id="fg-big">72</div>
                            <div class="gauge-label" id="fg-lbl" style="color:var(--gold)">Greed</div>
                            <div class="gauge-meter">
                                <div class="gauge-needle" id="gauge-needle" style="left:72%"></div>
                            </div>
                            <div class="gauge-sub">Updated hourly</div>
                        </div>
                    </div>

                    <!-- Dominance -->
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">‚¨° Dominance</span>
                        </div>
                        <div class="card-body" style="padding-top:0.5rem">
                            <div id="dom-list">
                                <!-- populated by JS -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ===== PORTFOLIO TABLE ===== -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üíº Portfolio Holdings</span>
                    <div style="display:flex;gap:0.5rem;align-items:center;">
                        <span style="font-size:0.75rem;color:var(--text-muted);font-family:var(--mono)">Total: </span>
                        <span style="font-size:0.85rem;font-weight:700;color:var(--neon-green)"
                            id="portfolio-total">$284,391</span>
                    </div>
                </div>
                <div style="overflow-x:auto;">
                    <table class="portfolio-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Asset</th>
                                <th>Price</th>
                                <th>Holdings</th>
                                <th>Value</th>
                                <th>24h</th>
                                <th>7d</th>
                                <th>Allocation</th>
                            </tr>
                        </thead>
                        <tbody id="portfolio-body">
                            <!-- populated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- ===== MARKET HEATMAP ===== -->
            <div class="card">
                <div class="card-header">
                    <span class="card-title">üó∫Ô∏è Market Heatmap ‚Äî Top 50</span>
                    <span style="font-size:0.72rem;color:var(--text-muted);font-family:var(--mono)">by 24h
                        performance</span>
                </div>
                <div class="heatmap-grid" id="heatmap"></div>
            </div>

            <!-- ===== DONUT + STATS ===== -->
            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üç© Portfolio Distribution</span>
                    </div>
                    <div class="card-body" style="display:flex;align-items:center;gap:2rem;flex-wrap:wrap;">
                        <div style="width:200px;height:200px;position:relative;flex-shrink:0;margin:0 auto;">
                            <canvas id="donut-chart"></canvas>
                            <div
                                style="position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;pointer-events:none;">
                                <div style="font-size:1.3rem;font-weight:700">$284K</div>
                                <div style="font-size:0.65rem;color:var(--text-muted);font-family:var(--mono)">TOTAL
                                </div>
                            </div>
                        </div>
                        <div style="flex:1;display:flex;flex-direction:column;gap:0.5rem;" id="donut-legend"></div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">üìä 24h Volume Leaders</span>
                    </div>
                    <div class="card-body" id="volume-list" style="display:flex;flex-direction:column;gap:0.5rem;">
                        <!-- populated -->
                    </div>
                </div>
            </div>

        </main>

        <!-- FOOTER -->
        <footer class="footer">
            <a href="#">GitHub</a>
            <a href="#">Twitter/X</a>
            <span>Powered by <a href="https://coingecko.com" target="_blank">CoinGecko API</a></span>
            <span style="color:var(--text-dim)">CryptoVerse v2.0.26 ‚Äî 2026</span>
        </footer>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <!-- ============================================================ -->
    <!-- SCRIPTS -->
    <!-- ============================================================ -->
    <script>
        // ============= THREE.JS BACKGROUND =============
        (function initBackground() {
            const canvas = document.getElementById('bg-canvas');
            const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.setSize(window.innerWidth, window.innerHeight);

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 30;

            // Grid / node field
            const NODES = 120;
            const nodeGeo = new THREE.BufferGeometry();
            const positions = new Float32Array(NODES * 3);
            const nodeData = [];

            for (let i = 0; i < NODES; i++) {
                const x = (Math.random() - 0.5) * 80;
                const y = (Math.random() - 0.5) * 60;
                const z = (Math.random() - 0.5) * 40;
                positions[i * 3] = x;
                positions[i * 3 + 1] = y;
                positions[i * 3 + 2] = z;
                nodeData.push({ x, y, z, vx: (Math.random() - 0.5) * 0.02, vy: (Math.random() - 0.5) * 0.02, vz: (Math.random() - 0.5) * 0.01 });
            }

            nodeGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            const nodeMat = new THREE.PointsMaterial({
                color: 0x6366f1,
                size: 0.3,
                transparent: true,
                opacity: 0.7,
                sizeAttenuation: true
            });
            const nodePoints = new THREE.Points(nodeGeo, nodeMat);
            scene.add(nodePoints);

            // Lines between nearby nodes
            const lineMat = new THREE.LineBasicMaterial({ color: 0x6366f1, transparent: true, opacity: 0.08 });
            const lineGroup = new THREE.Group();
            scene.add(lineGroup);

            function updateLines() {
                lineGroup.clear();
                const MAX_DIST = 15;
                for (let i = 0; i < NODES; i++) {
                    for (let j = i + 1; j < NODES; j++) {
                        const dx = nodeData[i].x - nodeData[j].x;
                        const dy = nodeData[i].y - nodeData[j].y;
                        const dz = nodeData[i].z - nodeData[j].z;
                        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);
                        if (dist < MAX_DIST) {
                            const lineGeo = new THREE.BufferGeometry().setFromPoints([
                                new THREE.Vector3(nodeData[i].x, nodeData[i].y, nodeData[i].z),
                                new THREE.Vector3(nodeData[j].x, nodeData[j].y, nodeData[j].z)
                            ]);
                            const line = new THREE.Line(lineGeo, lineMat);
                            lineGroup.add(line);
                        }
                    }
                }
            }

            // Mouse tracking
            let mouseX = 0, mouseY = 0;
            window.addEventListener('mousemove', e => {
                mouseX = (e.clientX / window.innerWidth - 0.5) * 2;
                mouseY = -(e.clientY / window.innerHeight - 0.5) * 2;
            });

            let frame = 0;
            function animate() {
                requestAnimationFrame(animate);
                frame++;

                // Move nodes
                for (let i = 0; i < NODES; i++) {
                    nodeData[i].x += nodeData[i].vx;
                    nodeData[i].y += nodeData[i].vy;
                    nodeData[i].z += nodeData[i].vz;
                    // Bounce
                    if (Math.abs(nodeData[i].x) > 40) nodeData[i].vx *= -1;
                    if (Math.abs(nodeData[i].y) > 30) nodeData[i].vy *= -1;
                    if (Math.abs(nodeData[i].z) > 20) nodeData[i].vz *= -1;
                    positions[i * 3] = nodeData[i].x;
                    positions[i * 3 + 1] = nodeData[i].y;
                    positions[i * 3 + 2] = nodeData[i].z;
                }
                nodeGeo.attributes.position.needsUpdate = true;

                // Update lines every 20 frames for performance
                if (frame % 20 === 0) updateLines();

                // Camera follows mouse gently
                camera.position.x += (mouseX * 3 - camera.position.x) * 0.03;
                camera.position.y += (mouseY * 2 - camera.position.y) * 0.03;
                camera.lookAt(scene.position);

                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            updateLines();
        })();

        // ============= THREE.JS ORB =============
        (function initOrb() {
            const canvas = document.getElementById('orb-canvas');
            const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 1.5));
            renderer.setSize(360, 320);

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(50, 360 / 320, 0.1, 100);
            camera.position.z = 5;

            // Central orb
            const orbGeo = new THREE.IcosahedronGeometry(1.2, 3);
            const orbMat = new THREE.MeshPhongMaterial({
                color: 0x6366f1,
                emissive: 0x3730a3,
                specular: 0xa855f7,
                shininess: 80,
                wireframe: false,
                transparent: true,
                opacity: 0.85
            });
            const orb = new THREE.Mesh(orbGeo, orbMat);
            scene.add(orb);

            // Wireframe overlay
            const wireGeo = new THREE.IcosahedronGeometry(1.22, 3);
            const wireMat = new THREE.MeshBasicMaterial({
                color: 0x818cf8,
                wireframe: true,
                transparent: true,
                opacity: 0.3
            });
            const wire = new THREE.Mesh(wireGeo, wireMat);
            scene.add(wire);

            // Orbiting coins
            const coinColors = [0xf59e0b, 0x8b5cf6, 0x06b6d4, 0x10b981, 0xec4899];
            const coinSpheres = [];
            const coinAngles = [0, 1.26, 2.51, 3.77, 5.03];
            const coinLabels = ['BTC', 'ETH', 'SOL', 'BNB', 'ADA'];

            coinColors.forEach((c, i) => {
                const g = new THREE.SphereGeometry(0.18, 16, 16);
                const m = new THREE.MeshPhongMaterial({ color: c, emissive: c, emissiveIntensity: 0.4 });
                const mesh = new THREE.Mesh(g, m);
                coinSpheres.push({ mesh, angle: coinAngles[i], speed: 0.005 + i * 0.001, radius: 2.0 + (i % 2) * 0.4 });
                scene.add(mesh);
            });

            // Lights
            const ambientLight = new THREE.AmbientLight(0x404060, 0.5);
            scene.add(ambientLight);
            const pointLight1 = new THREE.PointLight(0x6366f1, 2, 20);
            pointLight1.position.set(3, 3, 3);
            scene.add(pointLight1);
            const pointLight2 = new THREE.PointLight(0xec4899, 1, 20);
            pointLight2.position.set(-3, -2, 2);
            scene.add(pointLight2);

            let orbMouseX = 0, orbMouseY = 0;
            canvas.parentElement.addEventListener('mousemove', e => {
                const rect = canvas.getBoundingClientRect();
                orbMouseX = (e.clientX - rect.left - rect.width / 2) / rect.width * 2;
                orbMouseY = -(e.clientY - rect.top - rect.height / 2) / rect.height * 2;
            });

            function animateOrb() {
                requestAnimationFrame(animateOrb);
                const t = Date.now() * 0.001;

                orb.rotation.y = t * 0.3 + orbMouseX * 0.5;
                orb.rotation.x = t * 0.1 + orbMouseY * 0.2;
                wire.rotation.y = -t * 0.15;
                wire.rotation.x = t * 0.08;

                coinSpheres.forEach((c, i) => {
                    c.angle += c.speed;
                    c.mesh.position.x = Math.cos(c.angle) * c.radius;
                    c.mesh.position.y = Math.sin(c.angle * 0.6) * 0.5;
                    c.mesh.position.z = Math.sin(c.angle) * c.radius;
                });

                pointLight1.position.x = Math.cos(t * 0.5) * 4;
                pointLight1.position.z = Math.sin(t * 0.5) * 4;

                renderer.render(scene, camera);
            }
            animateOrb();
        })();

        // ============= DATA LAYER =============
        const PROXY = 'https://cryptoverse-production.up.railway.app/';
        const COINGECKO_BASE = PROXY + encodeURIComponent('https://api.coingecko.com/api/v3');

        const PORTFOLIO_HOLDINGS = [
            { id: 'bitcoin', symbol: 'BTC', name: 'Bitcoin', amount: 2.5, emoji: '‚Çø' },
            { id: 'ethereum', symbol: 'ETH', name: 'Ethereum', amount: 18, emoji: 'Œû' },
            { id: 'solana', symbol: 'SOL', name: 'Solana', amount: 120, emoji: '‚óé' },
            { id: 'binancecoin', symbol: 'BNB', name: 'BNB', amount: 35, emoji: 'üî∂' },
            { id: 'cardano', symbol: 'ADA', name: 'Cardano', amount: 8000, emoji: 'üîµ' },
            { id: 'avalanche-2', symbol: 'AVAX', name: 'Avalanche', amount: 80, emoji: 'üî∫' },
        ];

        const TOP_50_IDS = [
            'bitcoin', 'ethereum', 'tether', 'binancecoin', 'solana', 'ripple', 'usdc', 'cardano',
            'avalanche-2', 'dogecoin', 'polkadot', 'chainlink', 'near', 'litecoin', 'uniswap',
            'toncoin', 'matic-network', 'internet-computer', 'stellar', 'shiba-inu',
            'wrapped-bitcoin', 'dai', 'cosmos', 'hedera-hashgraph', 'aptos', 'arbitrum',
            'vechain', 'filecoin', 'injective-protocol', 'optimism', 'the-graph',
            'quant-network', 'aave', 'maker', 'synthetix-network-token', 'curve-dao-token',
            'decentraland', 'sandbox', 'axie-infinity', 'enjincoin', 'flow', 'theta-token',
            'stacks', 'render-token', 'ocean-protocol', 'blur', 'gmx', 'lido-dao',
            'rocket-pool', 'frax-share'
        ];

        let globalData = {};
        let priceChart = null;
        let donutChart = null;
        let currentCoin = 'bitcoin';
        let currentTF = 7;
        let previousPrices = {};

        // Fetch coin market data
        async function fetchMarketData() {
            try {
                const ids = [...new Set([...PORTFOLIO_HOLDINGS.map(h => h.id), ...TOP_50_IDS])].join(',');
                const res = await fetch(`${COINGECKO_BASE}/coins/markets?vs_currency=usd&ids=${ids}&order=market_cap_desc&per_page=100&sparkline=true&price_change_percentage=24h,7d`);
                if (!res.ok) throw new Error('Rate limited');
                const data = await res.json();
                data.forEach(c => { globalData[c.id] = c; });
                return data;
            } catch (e) {
                console.warn('API fetch failed, using demo data');
                return null;
            }
        }

        // Demo data fallback
        function getDemoData() {
            const coins = [
                { id: 'bitcoin', symbol: 'btc', name: 'Bitcoin', current_price: 97420, price_change_percentage_24h: 3.2, price_change_percentage_7d_in_currency: 8.4, market_cap: 1920000000000, total_volume: 42000000000, image: 'https://assets.coingecko.com/coins/images/1/small/bitcoin.png', sparkline_in_7d: { price: Array.from({ length: 168 }, (_, i) => 92000 + Math.sin(i / 20) * 3000 + Math.random() * 2000) } },
                { id: 'ethereum', symbol: 'eth', name: 'Ethereum', current_price: 3280, price_change_percentage_24h: -1.4, price_change_percentage_7d_in_currency: 5.1, market_cap: 394000000000, total_volume: 18000000000, image: 'https://assets.coingecko.com/coins/images/279/small/ethereum.png', sparkline_in_7d: { price: Array.from({ length: 168 }, (_, i) => 3100 + Math.sin(i / 15) * 150 + Math.random() * 100) } },
                { id: 'solana', symbol: 'sol', name: 'Solana', current_price: 214.5, price_change_percentage_24h: 7.8, price_change_percentage_7d_in_currency: 21.3, market_cap: 101000000000, total_volume: 7800000000, image: 'https://assets.coingecko.com/coins/images/4128/small/solana.png', sparkline_in_7d: { price: Array.from({ length: 168 }, (_, i) => 178 + Math.sin(i / 12) * 20 + Math.random() * 15) } },
                { id: 'binancecoin', symbol: 'bnb', name: 'BNB', current_price: 628, price_change_percentage_24h: 2.1, price_change_percentage_7d_in_currency: 4.3, market_cap: 91000000000, total_volume: 2200000000, image: 'https://assets.coingecko.com/coins/images/825/small/bnb-icon2_2x.png', sparkline_in_7d: { price: Array.from({ length: 168 }, (_, i) => 600 + Math.sin(i / 18) * 25 + Math.random() * 15) } },
                { id: 'cardano', symbol: 'ada', name: 'Cardano', current_price: 0.82, price_change_percentage_24h: -2.3, price_change_percentage_7d_in_currency: -1.2, market_cap: 29000000000, total_volume: 980000000, image: 'https://assets.coingecko.com/coins/images/975/small/cardano.png', sparkline_in_7d: { price: Array.from({ length: 168 }, (_, i) => 0.78 + Math.sin(i / 22) * 0.05 + Math.random() * 0.03) } },
                { id: 'avalanche-2', symbol: 'avax', name: 'Avalanche', current_price: 42.8, price_change_percentage_24h: 5.6, price_change_percentage_7d_in_currency: 14.2, market_cap: 17600000000, total_volume: 850000000, image: 'https://assets.coingecko.com/coins/images/12559/small/Avalanche_Circle_RedWhite_Trans.png', sparkline_in_7d: { price: Array.from({ length: 168 }, (_, i) => 36 + Math.sin(i / 10) * 4 + Math.random() * 3) } },
                { id: 'ripple', symbol: 'xrp', name: 'XRP', current_price: 2.14, price_change_percentage_24h: 4.8, price_change_percentage_7d_in_currency: 18.7, market_cap: 123000000000, total_volume: 6500000000, image: 'https://assets.coingecko.com/coins/images/44/small/xrp-symbol-white-128.png', sparkline_in_7d: { price: Array.from({ length: 168 }, (_, i) => 1.8 + Math.sin(i / 8) * 0.3 + Math.random() * 0.2) } },
                { id: 'dogecoin', symbol: 'doge', name: 'Dogecoin', current_price: 0.382, price_change_percentage_24h: 11.4, price_change_percentage_7d_in_currency: 32.1, market_cap: 55000000000, total_volume: 4200000000, image: 'https://assets.coingecko.com/coins/images/5/small/dogecoin.png', sparkline_in_7d: { price: Array.from({ length: 168 }, (_, i) => 0.28 + Math.sin(i / 6) * 0.06 + Math.random() * 0.04) } },
            ];
            coins.forEach(c => { globalData[c.id] = c; });

            // Fill rest of top50 with generated data
            const symbols = ['MATIC', 'DOT', 'LINK', 'UNI', 'ATOM', 'NEAR', 'LTC', 'ICP', 'XLM', 'SHIB', 'WBTC', 'DAI', 'CRO', 'APT', 'ARB', 'VET', 'FIL', 'INJ', 'OP', 'GRT', 'QNT', 'AAVE', 'MKR', 'SNX', 'CRV', 'MANA', 'SAND', 'AXS', 'ENJ', 'FLOW', 'THETA', 'STX', 'RNDR', 'OCEAN', 'BLUR', 'GMX', 'LDO', 'RPL', 'FXS', 'FRAX', 'APE', 'GALA', 'CAKE', 'ZIL', 'ENS', '1INCH', 'COMP', 'YFI', 'UMA', 'SUSHI'];
            TOP_50_IDS.forEach((id, i) => {
                if (!globalData[id]) {
                    const chg = (Math.random() - 0.45) * 20;
                    globalData[id] = {
                        id, symbol: (symbols[i - 8] || 'ALT').toLowerCase(), name: id,
                        current_price: Math.random() * 500,
                        price_change_percentage_24h: chg,
                        price_change_percentage_7d_in_currency: chg * 2.5,
                        market_cap: Math.random() * 20000000000,
                        total_volume: Math.random() * 2000000000,
                        image: ''
                    };
                }
            });
            return Object.values(globalData);
        }

        // Format numbers
        const fmt = (n, decimals = 2) => n == null ? '--' : Number(n).toLocaleString('en-US', { minimumFractionDigits: decimals, maximumFractionDigits: decimals });
        const fmtUSD = (n) => n >= 1e12 ? `$${(n / 1e12).toFixed(2)}T` : n >= 1e9 ? `$${(n / 1e9).toFixed(1)}B` : n >= 1e6 ? `$${(n / 1e6).toFixed(1)}M` : `$${fmt(n)}`;
        const fmtPct = (n) => n == null ? '--' : `${n > 0 ? '+' : ''}${fmt(n)}%`;
        const priceStr = (p) => p >= 1000 ? `$${p.toLocaleString('en-US', { maximumFractionDigits: 0 })}` : p >= 1 ? `$${fmt(p)}` : `$${p.toFixed(5)}`;

        // ===== RENDER FUNCTIONS =====

        function renderMovers(data) {
            const container = document.getElementById('movers-grid');
            // Sort by 24h change desc for gainers
            const sorted = [...data.filter(c => c.current_price && c.price_change_percentage_24h != null)]
                .sort((a, b) => Math.abs(b.price_change_percentage_24h) - Math.abs(a.price_change_percentage_24h))
                .slice(0, 8);

            container.innerHTML = sorted.map(c => {
                const chg = c.price_change_percentage_24h;
                const upDown = chg >= 0 ? 'up' : 'down';
                const spark = c.sparkline_in_7d?.price || [];
                const sparkData = spark.slice(-48); // last 48 points
                const sparkSvg = generateSparkSvg(sparkData, chg >= 0);

                return `
    <div class="mover-card" onclick="showToast('${c.name}','${priceStr(c.current_price)} ¬∑ Vol: ${fmtUSD(c.total_volume || 0)}')" data-id="${c.id}">
      <div class="mover-top">
        <div class="coin-info">
          <div class="coin-icon">
            ${c.image ? `<img src="${c.image}" alt="${c.symbol}" onerror="this.parentElement.textContent='${c.symbol?.charAt(0) || '?'}'" loading="lazy">` : c.symbol?.charAt(0) || '?'}
          </div>
          <div>
            <div class="coin-name">${c.name}</div>
            <div class="coin-ticker">${c.symbol?.toUpperCase()}</div>
          </div>
        </div>
        <span class="coin-change ${upDown}">${fmtPct(chg)}</span>
      </div>
      <div class="coin-price" id="price-${c.id}">${priceStr(c.current_price)}</div>
      <div class="coin-meta">Vol: ${fmtUSD(c.total_volume || 0)}</div>
      <div class="sparkline">${sparkSvg}</div>
    </div>`;
            }).join('');
        }

        function generateSparkSvg(data, positive) {
            if (!data || data.length < 2) return '<svg viewBox="0 0 100 40"><line x1="0" y1="20" x2="100" y2="20" stroke="#334155" stroke-width="1"/></svg>';
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min || 1;
            const pts = data.map((v, i) => {
                const x = (i / (data.length - 1)) * 100;
                const y = 36 - ((v - min) / range) * 32;
                return `${x},${y}`;
            });
            const color = positive ? '#10b981' : '#ef4444';
            const gColor = positive ? 'rgba(16,185,129,0.2)' : 'rgba(239,68,68,0.2)';
            const poly = `${pts[0].split(',')[0]},36 ${pts.join(' ')} ${pts[pts.length - 1].split(',')[0]},36`;
            return `<svg viewBox="0 0 100 40" preserveAspectRatio="none" style="width:100%;height:100%">
    <defs>
      <linearGradient id="g${Date.now()}" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="${gColor}"/>
        <stop offset="100%" stop-color="transparent"/>
      </linearGradient>
    </defs>
    <polygon points="${poly}" fill="${gColor}"/>
    <polyline points="${pts.join(' ')}" fill="none" stroke="${color}" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`;
        }

        function renderPortfolio(data) {
            const body = document.getElementById('portfolio-body');
            let total = 0;
            const rows = PORTFOLIO_HOLDINGS.map(h => {
                const d = globalData[h.id];
                if (!d) return null;
                const value = d.current_price * h.amount;
                total += value;
                return { ...h, data: d, value };
            }).filter(Boolean);

            rows.forEach(r => r.alloc = (r.value / total) * 100);

            body.innerHTML = rows.map((r, i) => {
                const chg24 = r.data.price_change_percentage_24h;
                const chg7 = r.data.price_change_percentage_7d_in_currency;
                return `
    <tr>
      <td class="rank">${i + 1}</td>
      <td>
        <div class="coin-info">
          <div class="coin-icon" style="width:28px;height:28px;font-size:14px">
            ${r.data.image ? `<img src="${r.data.image}" alt="${r.symbol}" onerror="this.parentElement.textContent='${r.symbol.charAt(0)}'" loading="lazy">` : r.emoji}
          </div>
          <div>
            <div style="font-weight:600;font-size:0.85rem">${r.name}</div>
            <div style="font-size:0.68rem;color:var(--text-muted);font-family:var(--mono)">${r.symbol}</div>
          </div>
        </div>
      </td>
      <td style="font-family:var(--mono);font-size:0.85rem;font-weight:600" id="tbl-price-${r.id}">${priceStr(r.data.current_price)}</td>
      <td style="font-family:var(--mono);font-size:0.8rem;color:var(--text-muted)">${fmt(r.amount, r.amount < 1 ? 4 : 2)} ${r.symbol}</td>
      <td style="font-family:var(--mono);font-size:0.85rem;font-weight:600">$${fmt(r.value)}</td>
      <td class="${chg24 >= 0 ? 'up' : 'down'}" style="font-family:var(--mono);font-size:0.8rem;font-weight:600">${fmtPct(chg24)}</td>
      <td class="${chg7 >= 0 ? 'up' : 'down'}" style="font-family:var(--mono);font-size:0.8rem;font-weight:600">${fmtPct(chg7)}</td>
      <td>
        <div class="alloc-bar">
          <div class="alloc-track">
            <div class="alloc-fill" style="width:${r.alloc}%"></div>
          </div>
          <span class="alloc-pct">${fmt(r.alloc, 1)}%</span>
        </div>
      </td>
    </tr>`;
            }).join('');

            // Update totals
            document.getElementById('portfolio-total').textContent = '$' + fmt(total);
            document.getElementById('portfolio-value').textContent = '$' + fmt(total);

            renderDonut(rows, total);
            renderVolumeList();
        }

        function renderDonut(rows, total) {
            const colors = ['#6366f1', '#8b5cf6', '#22d3ee', '#10b981', '#f59e0b', '#ec4899'];
            const ctx = document.getElementById('donut-chart').getContext('2d');

            if (donutChart) donutChart.destroy();
            donutChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: rows.map(r => r.symbol),
                    datasets: [{
                        data: rows.map(r => r.value),
                        backgroundColor: colors.slice(0, rows.length),
                        borderWidth: 2,
                        borderColor: '#020207',
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: { display: false }, tooltip: {
                            callbacks: {
                                label: ctx => ` $${fmt(ctx.raw)} (${fmt(ctx.raw / total * 100, 1)}%)`
                            }
                        }
                    }
                }
            });

            const legend = document.getElementById('donut-legend');
            legend.innerHTML = rows.map((r, i) => `
    <div style="display:flex;align-items:center;gap:0.5rem;padding:0.3rem 0">
      <span style="width:10px;height:10px;border-radius:2px;background:${colors[i]};flex-shrink:0"></span>
      <span style="font-size:0.8rem;font-weight:600;flex:1">${r.name}</span>
      <span style="font-size:0.75rem;font-family:var(--mono);color:var(--text-muted)">${fmt(r.alloc, 1)}%</span>
    </div>
  `).join('');
        }

        function renderVolumeList() {
            const top = Object.values(globalData)
                .filter(c => c.total_volume)
                .sort((a, b) => b.total_volume - a.total_volume)
                .slice(0, 8);

            const maxVol = top[0]?.total_volume || 1;
            const el = document.getElementById('volume-list');
            el.innerHTML = top.map(c => {
                const pct = (c.total_volume / maxVol) * 100;
                const chg = c.price_change_percentage_24h || 0;
                return `
    <div style="display:flex;align-items:center;gap:0.75rem">
      <div class="coin-icon" style="width:24px;height:24px;font-size:12px">
        ${c.image ? `<img src="${c.image}" alt="${c.symbol}" onerror="this.parentElement.textContent='${c.symbol?.charAt(0) || '?'}'" loading="lazy">` : c.symbol?.charAt(0)}
      </div>
      <span style="font-size:0.8rem;font-weight:600;min-width:3rem">${c.symbol?.toUpperCase()}</span>
      <div class="alloc-track" style="flex:1;height:4px">
        <div class="alloc-fill" style="width:${pct}%;background:${chg >= 0 ? 'var(--neon-green)' : 'var(--neon-red)'}"></div>
      </div>
      <span style="font-family:var(--mono);font-size:0.7rem;color:var(--text-muted);min-width:4rem;text-align:right">${fmtUSD(c.total_volume)}</span>
    </div>`;
            }).join('');
        }

        function renderDominance(data) {
            // Using market cap ratios
            const totalMcap = data.reduce((s, c) => s + (c.market_cap || 0), 0);
            const top = [
                { id: 'bitcoin', color: 'var(--gold)', label: 'BTC' },
                { id: 'ethereum', color: 'var(--neon-violet)', label: 'ETH' },
                { id: 'tether', color: 'var(--neon-green)', label: 'USDT' },
                { id: 'binancecoin', color: '#f59e0b', label: 'BNB' },
                { id: 'solana', color: 'var(--neon-cyan)', label: 'SOL' },
            ].map(t => ({
                ...t,
                pct: totalMcap > 0 ? ((globalData[t.id]?.market_cap || 0) / totalMcap * 100) : 0
            }));

            const el = document.getElementById('dom-list');
            el.innerHTML = top.map(t => `
    <div class="dominance-row">
      <span class="dom-name" style="color:${t.color}">${t.label}</span>
      <div class="dom-bar-track">
        <div class="dom-bar-fill" style="width:${t.pct}%;background:${t.color}"></div>
      </div>
      <span class="dom-pct" style="color:${t.color}">${fmt(t.pct, 1)}%</span>
    </div>
  `).join('');

            // Update quick stats
            if (top[0]) document.getElementById('btc-dom').textContent = `${fmt(top[0].pct, 1)}%`;
            if (top[1]) document.getElementById('eth-dom').textContent = `${fmt(top[1].pct, 1)}%`;

            const totalFmt = totalMcap >= 1e12 ? `$${(totalMcap / 1e12).toFixed(2)}T` : fmtUSD(totalMcap);
            document.getElementById('global-mcap').textContent = totalFmt;
        }

        function renderHeatmap() {
            const cells = TOP_50_IDS.map(id => globalData[id]).filter(Boolean);
            const el = document.getElementById('heatmap');
            el.innerHTML = cells.slice(0, 50).map(c => {
                const chg = c.price_change_percentage_24h || 0;
                const intensity = Math.min(Math.abs(chg) / 15, 1);
                let bg;
                if (chg > 0) bg = `rgba(16,185,129,${0.2 + intensity * 0.7})`;
                else bg = `rgba(239,68,68,${0.2 + intensity * 0.7})`;

                return `
    <div class="heatmap-cell" style="background:${bg}" title="${c.name}: ${fmtPct(chg)}">
      <div class="cell-tooltip">
        <span style="font-size:0.48rem;text-align:center;line-height:1.2">${c.symbol?.toUpperCase()}</span>
        <span style="font-size:0.45rem">${fmtPct(chg)}</span>
      </div>
    </div>`;
            }).join('');
        }

        // ===== PRICE CHART =====
        async function fetchPriceHistory(coinId, days) {
            try {
                const res = await fetch(`${COINGECKO_BASE}/coins/${coinId}/market_chart?vs_currency=usd&days=${days}`);
                if (!res.ok) throw new Error();
                const json = await res.json();
                return json.prices;
            } catch {
                // Demo data
                const now = Date.now();
                const points = 168;
                const basePrice = globalData[coinId]?.current_price || 1000;
                return Array.from({ length: points }, (_, i) => {
                    const t = now - (points - i) * 3600000;
                    const noise = Math.sin(i / 8) * 0.08 + Math.sin(i / 3) * 0.03 + (Math.random() - 0.5) * 0.04;
                    return [t, basePrice * (0.9 + noise)];
                });
            }
        }

        async function renderPriceChart(coinId = 'bitcoin', days = 7) {
            const prices = await fetchPriceHistory(coinId, days);
            if (!prices) return;

            const labels = prices.map(p => {
                const d = new Date(p[0]);
                return days <= 1 ? d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }) : d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            });
            const values = prices.map(p => p[1]);
            const isUp = values[values.length - 1] >= values[0];
            const color = isUp ? '#10b981' : '#ef4444';
            const gColor = isUp ? 'rgba(16,185,129,' : 'rgba(239,68,68,';

            const ctx = document.getElementById('price-chart').getContext('2d');

            if (priceChart) priceChart.destroy();

            const gradient = ctx.createLinearGradient(0, 0, 0, 280);
            gradient.addColorStop(0, gColor + '0.25)');
            gradient.addColorStop(0.6, gColor + '0.05)');
            gradient.addColorStop(1, gColor + '0)');

            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels,
                    datasets: [{
                        data: values,
                        borderColor: color,
                        borderWidth: 2,
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 5,
                        pointHoverBackgroundColor: color,
                        pointHoverBorderColor: '#fff',
                        pointHoverBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(7,7,26,0.95)',
                            borderColor: 'rgba(99,102,241,0.3)',
                            borderWidth: 1,
                            titleColor: '#94a3b8',
                            bodyColor: '#f1f5f9',
                            bodyFont: { family: "'JetBrains Mono'" },
                            callbacks: {
                                label: ctx => ' ' + priceStr(ctx.raw)
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255,255,255,0.04)', drawBorder: false },
                            ticks: { color: '#475569', font: { family: "'JetBrains Mono'", size: 10 }, maxTicksLimit: 8 },
                            border: { display: false }
                        },
                        y: {
                            grid: { color: 'rgba(255,255,255,0.04)', drawBorder: false },
                            ticks: { color: '#475569', font: { family: "'JetBrains Mono'", size: 10 }, callback: v => priceStr(v) },
                            border: { display: false },
                            position: 'right'
                        }
                    }
                }
            });
        }

        function switchCoin(el, coinId) {
            document.querySelectorAll('[data-coin]').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            currentCoin = coinId;
            renderPriceChart(coinId, currentTF);
        }

        // ===== TF BUTTONS =====
        document.querySelectorAll('[data-tf]').forEach(btn => {
            btn.addEventListener('click', function () {
                document.querySelectorAll('[data-tf]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentTF = parseInt(this.dataset.tf);
                renderPriceChart(currentCoin, currentTF);
            });
        });

        // ===== TOAST =====
        function showToast(title, msg, type = 'info') {
            const container = document.getElementById('toast-container');
            const icons = { info: 'üìä', up: 'üöÄ', down: 'üìâ', wallet: 'üîó' };
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
    <span class="toast-icon">${icons[type] || 'üìä'}</span>
    <div>
      <div class="toast-title">${title}</div>
      <div class="toast-msg">${msg}</div>
    </div>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.animation = 'none'; toast.style.opacity = '0'; toast.style.transition = 'opacity 0.3s'; setTimeout(() => toast.remove(), 300); }, 4000);
        }

        function connectWallet() {
            showToast('Wallet Connect', 'MetaMask, WalletConnect, Coinbase ‚Äî coming soon!', 'wallet');
        }

        // ===== FEAR & GREED =====
        async function fetchFearGreed() {
            try {
                const res = await fetch('https://cryptoverse-production.up.railway.app/' + encodeURIComponent('https://api.alternative.me/fng/?limit=1'));
                const json = await res.json();
                const val = parseInt(json.data[0].value);
                const label = json.data[0].value_classification;
                document.getElementById('fg-value').textContent = val;
                document.getElementById('fg-big').textContent = val;
                document.getElementById('fg-label').textContent = label;
                document.getElementById('fg-lbl').textContent = label;
                document.getElementById('gauge-needle').style.left = `${val}%`;

                const col = val >= 60 ? 'var(--neon-green)' : val >= 40 ? 'var(--gold)' : 'var(--neon-red)';
                document.getElementById('fg-big').style.color = col;
            } catch {
                // defaults already set
            }
        }

        // ===== PRICE FLASH ON UPDATE =====
        function flashPriceChange(elId, newPrice, oldPrice) {
            const el = document.getElementById(elId);
            if (!el || !oldPrice) return;
            const cls = newPrice > oldPrice ? 'flash-green' : newPrice < oldPrice ? 'flash-red' : null;
            if (cls) {
                el.classList.remove('flash-green', 'flash-red');
                void el.offsetWidth; // reflow
                el.classList.add(cls);
                setTimeout(() => el.classList.remove(cls), 800);
            }
        }

        // ===== UPDATE TIMESTAMP =====
        function updateTimestamp() {
            const el = document.getElementById('last-update');
            const now = new Date();
            el.textContent = `LIVE ¬∑ ${now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' })}`;
        }

        // ===== MAIN LOAD =====
        async function loadData() {
            let data = await fetchMarketData();
            if (!data || data.length === 0) data = getDemoData();

            renderMovers(Object.values(globalData));
            renderPortfolio(data);
            renderDominance(data);
            renderHeatmap();
            await renderPriceChart(currentCoin, currentTF);
            await fetchFearGreed();
            updateTimestamp();
            checkForAlerts();
        }

        function checkForAlerts() {
            Object.values(globalData).forEach(c => {
                const chg = c.price_change_percentage_24h;
                if (Math.abs(chg) >= 10) {
                    const type = chg > 0 ? 'up' : 'down';
                    showToast(`${c.name} ${chg > 0 ? 'üöÄ' : 'üìâ'}`, `${fmtPct(chg)} in 24h ¬∑ ${priceStr(c.current_price)}`, type);
                }
            });
        }

        async function refreshData() {
            const prevData = { ...globalData };
            await loadData();

            // Flash changed prices
            Object.keys(globalData).forEach(id => {
                if (prevData[id]) {
                    flashPriceChange(`price-${id}`, globalData[id].current_price, prevData[id].current_price);
                    flashPriceChange(`tbl-price-${id}`, globalData[id].current_price, prevData[id].current_price);
                }
            });
        }

        // Search
        document.getElementById('search-input').addEventListener('input', function () {
            const q = this.value.toLowerCase();
            if (!q) { renderMovers(Object.values(globalData)); return; }
            const filtered = Object.values(globalData).filter(c =>
                c.name?.toLowerCase().includes(q) || c.symbol?.toLowerCase().includes(q)
            );
            renderMovers(filtered);
        });

        // Init
        loadData();

        // Auto-refresh every 30s (rate limit friendly)
        setInterval(refreshData, 30000);
        setInterval(updateTimestamp, 1000);
    </script>
</body>

</html>